<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Marketing Mastery - Kane's Bookstore</title>
    <meta name="description"
        content="Master digital marketing with our comprehensive guide. Get instant access plus exclusive NFT certificate.">

    <!-- Kane's Bookstore Styles -->
    <link rel="stylesheet" href="assets/css/kanes-bookstore.css">

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/pdf-js-dist@3.11.174/build/pdf.min.js"></script>
    <script src="https://unpkg.com/ethers@6.8.0/dist/ethers.umd.min.js"></script>

    <!-- Additional Styling for Better UX -->
    <style>
        .access-explanation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            text-align: center;
        }

        .access-explanation h2 {
            margin-bottom: 16px;
            font-size: 1.5rem;
        }

        .access-explanation p {
            font-size: 1.1rem;
            margin-bottom: 16px;
            opacity: 0.9;
        }

        .access-paths {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .access-path {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .access-path:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .access-path.active {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .access-path-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .access-path h3 {
            margin-bottom: 12px;
            color: #333;
        }

        .access-path p {
            color: #666;
            margin-bottom: 16px;
        }

        .how-it-works {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }

        .how-it-works h3 {
            text-align: center;
            margin-bottom: 24px;
            color: #333;
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .step {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            line-height: 40px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .step h4 {
            margin-bottom: 8px;
            color: #333;
        }

        .step p {
            color: #666;
            font-size: 0.9rem;
        }

        .nft-info-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 16px 0;
        }

        .nft-info-card h4 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nft-info-card p {
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .nft-info-card code {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .benefit-item {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .benefit-icon {
            font-size: 1.5rem;
        }

        .benefit-text {
            font-size: 0.9rem;
            color: #333;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .section-divider {
            border: none;
            height: 1px;
            background: linear-gradient(to right, transparent, #667eea, transparent);
            margin: 32px 0;
        }

        /* Smooth scroll and animation styles */
        .scroll-target {
            scroll-margin-top: 20px;
        }

        /* Enhanced section visibility */
        #nft-access-section,
        #purchase-section,
        #success-section {
            transition: all 0.4s ease;
        }

        #nft-access-section.show,
        #purchase-section.show,
        #success-section.show {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        @media (max-width: 768px) {
            .access-paths {
                grid-template-columns: 1fr;
            }

            .steps {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <!-- GoHighLevel Integration -->
    <script>
        // GoHighLevel data integration
        window.addEventListener('DOMContentLoaded', function () {
            // Auto-populate product data from GHL custom fields
            if (typeof window.leadConnector !== 'undefined') {
                const contact = window.leadConnector.getContact();
                console.log('GHL Contact Data:', contact);
            }
        });
    </script>
</head>

<body>
    <!-- Header -->
    <header class="kb-header">
        <div class="container">
            <nav class="kb-nav">
                <a href="../index.html" class="kb-logo">Kane's Bookstore</a>
                <ul class="kb-nav-links">
                    <li><a href="../index.html#screens">All Demos</a></li>
                    <li><a href="../index.html#features">Features</a></li>
                    <li><a href="../index.html#demo-journey">Demo Journey</a></li>
                </ul>

                <!-- Wallet Connection -->
                <div class="wallet-connection">
                    <button id="connect-wallet-btn" class="btn btn-wallet" onclick="openWalletModal()">
                        üîó Connect Wallet
                    </button>
                    <div id="wallet-info" class="wallet-info" style="display: none;">
                        <span id="wallet-address" class="wallet-address"></span>
                        <span id="chain-indicator" class="chain-indicator"></span>
                        <button onclick="disconnectWallet()" class="btn-disconnect">Disconnect</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Product Detail Section -->
    <main class="product-detail">
        <div class="container">
            <!-- Access Explanation Banner -->
            <div class="access-explanation">
                <h2>üöÄ Revolutionary Book Access System</h2>
                <p>Experience our new hybrid access model - purchase the book traditionally OR access it instantly for
                    FREE if you own the right NFT!</p>
                <p><strong>What's an NFT?</strong> Think of it as a digital membership card that proves you own
                    something special. If you have one from our premium collection, you can read this book at no extra
                    cost!</p>
            </div>

            <div class="row">
                <!-- Product Image -->
                <div class="col col-12 col-lg-6">
                    <img src="https://storage.googleapis.com/msgsndr/YyXjhz49RRIC60sTREka/media/471261f9-ae0f-4820-bbae-65537b93f351.png"
                        alt="Digital Marketing Mastery Book Cover" class="product-image" data-product-image>
                </div>

                <!-- Product Information -->
                <div class="col col-12 col-lg-6">
                    <!-- Product Title -->
                    <h1 class="product-title" data-product-title>
                        Digital Marketing Mastery
                    </h1>

                    <!-- Access Level Badge -->
                    <div class="access-level-badge">
                        <span class="badge premium">Premium Content</span>
                    </div>

                    <!-- Access Path Selection -->
                    <div class="access-paths">
                        <div class="access-path" id="nft-path">
                            <div class="access-path-icon">üé®</div>
                            <h3>NFT Holder Access</h3>
                            <p>Own a qualifying NFT? Read for <strong>FREE</strong>!</p>
                            <div class="tooltip">
                                <button class="btn btn-secondary" onclick="selectNFTPath()">
                                    Check My NFTs
                                </button>
                                <span class="tooltiptext">Connect your wallet to check if you own qualifying NFTs</span>
                            </div>
                        </div>

                        <div class="access-path" id="purchase-path">
                            <div class="access-path-icon">üí≥</div>
                            <h3>Purchase Access</h3>
                            <p>Buy the book and get lifetime access</p>
                            <button class="btn btn-primary" onclick="selectPurchasePath()">
                                Buy for $25.00
                            </button>
                        </div>
                    </div>

                    <!-- How It Works Section -->
                    <div class="how-it-works">
                        <h3>üìö How Our System Works</h3>
                        <div class="steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <h4>Choose Your Path</h4>
                                <p>Select NFT access (if you have qualifying NFTs) or purchase directly</p>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <h4>Verify Access</h4>
                                <p>Connect wallet for NFT verification or complete payment</p>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <h4>Start Reading</h4>
                                <p>Access our premium online reader with your content</p>
                            </div>
                        </div>
                    </div>

                    <!-- NFT Access Section (Hidden by default) -->
                    <div id="nft-access-section" class="scroll-target" style="display: none;">
                        <div class="nft-info-card">
                            <h4>üé® NFT Access Requirements</h4>
                            <p><strong>Required Collection:</strong> Kane's Premium Collection</p>
                            <p><strong>Contract Address:</strong> <code>0x742d35Cc6634C0532925a3b8D1c6F0de</code></p>
                            <p><strong>Network:</strong> Ethereum Mainnet</p>
                            <p>üí° Own any NFT from this collection to unlock free access!</p>
                        </div>

                        <div class="nft-validation" id="nft-validation">
                            <button id="check-nfts-btn" onclick="checkNFTAccess()" class="btn btn-check-nfts" disabled>
                                üîó Connect Wallet to Check NFTs
                            </button>
                            <div id="nft-status" class="nft-status">
                                Connect your wallet to check NFT access
                            </div>
                        </div>
                    </div>

                    <!-- Purchase Section (Hidden by default) -->
                    <div id="purchase-section" class="scroll-target" style="display: none;">
                        <!-- Pricing Display -->
                        <div class="pricing-container">
                            <div class="usd-price" data-product-price>$25.00</div>
                            <div class="crypto-equivalent">
                                <strong>Crypto Options:</strong><br>
                                <span data-crypto="btc">‚âà 0.0008 BTC</span><br>
                                <span data-crypto="eth">‚âà 0.0156 ETH</span><br>
                                <span data-crypto="usdc">‚âà 25.00 USDC</span>
                            </div>
                        </div>

                        <!-- Payment Buttons -->
                        <div class="payment-buttons">
                            <button class="btn btn-primary btn-block btn-lg" data-action="stripe-payment"
                                data-product-id="digital-marketing-mastery"
                                data-product-title="Digital Marketing Mastery" data-product-price="25.00"
                                data-product-image="https://storage.googleapis.com/msgsndr/YyXjhz49RRIC60sTREka/media/471261f9-ae0f-4820-bbae-65537b93f351.png"
                                data-product-description="Transform your business with our comprehensive digital marketing guide.">
                                üí≥ Buy with Credit Card ($25.00)
                            </button>

                            <button class="btn btn-secondary btn-block btn-lg" data-action="show-payment-modal">
                                ‚Çø Pay with Cryptocurrency
                            </button>
                        </div>
                    </div>

                    <!-- Success Section (Hidden by default) -->
                    <div id="success-section" class="scroll-target" style="display: none;">
                        <div class="alert alert-success"
                            style="background: #d4edda; color: #155724; padding: 16px; border-radius: 8px; margin: 16px 0;">
                            <h4>‚úÖ Access Granted!</h4>
                            <p id="access-message">You now have full access to this book.</p>
                        </div>

                        <button id="btn-read-now" class="btn btn-success btn-block btn-lg" onclick="openEbookReader()">
                            üìñ Start Reading Now
                        </button>
                    </div>

                    <hr class="section-divider">

                    <!-- Product Description -->
                    <div class="product-description" data-product-description>
                        <h3>üìñ About This Book</h3>
                        <p>Transform your business with our comprehensive digital marketing guide. This expertly crafted
                            resource covers everything from social media strategy to conversion optimization.</p>

                        <p>Perfect for entrepreneurs, marketers, and business owners looking to master the digital
                            landscape and drive real results.</p>

                        <div class="benefits-grid">
                            <div class="benefit-item">
                                <div class="benefit-icon">üìö</div>
                                <div class="benefit-text">200+ page comprehensive guide</div>
                            </div>
                            <div class="benefit-item">
                                <div class="benefit-icon">üéØ</div>
                                <div class="benefit-text">Step-by-step strategies</div>
                            </div>
                            <div class="benefit-item">
                                <div class="benefit-icon">üíº</div>
                                <div class="benefit-text">Real-world case studies</div>
                            </div>
                            <div class="benefit-item">
                                <div class="benefit-icon">üìã</div>
                                <div class="benefit-text">Bonus templates & worksheets</div>
                            </div>
                            <div class="benefit-item">
                                <div class="benefit-icon">üë•</div>
                                <div class="benefit-text">Exclusive community access</div>
                            </div>
                            <div class="benefit-item">
                                <div class="benefit-icon">üìñ</div>
                                <div class="benefit-text">Online reader access</div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Features -->
                    <div class="product-features">
                        <h3>üéÅ What You Get</h3>
                        <ul>
                            <li>‚úÖ Instant access after verification/purchase</li>
                            <li>‚úÖ 30-day money-back guarantee (for purchases)</li>
                            <li>‚úÖ NFT certificate of ownership included</li>
                            <li>‚úÖ Lifetime access to updates</li>
                            <li>‚úÖ Priority customer support</li>
                            <li>‚úÖ Advanced online ebook reader</li>
                            <li>‚úÖ Cross-device reading progress sync</li>
                            <li>‚úÖ Download capabilities (after purchase)</li>
                        </ul>
                    </div>

                    <!-- Security Badges -->
                    <div class="security-badges">
                        <div class="security-badge">
                            <span>üîí</span>
                            <span>SSL Secured</span>
                        </div>
                        <div class="security-badge">
                            <span>üí≥</span>
                            <span>Stripe Protected</span>
                        </div>
                        <div class="security-badge">
                            <span>‚Çø</span>
                            <span>Crypto Payments</span>
                        </div>
                        <div class="security-badge">
                            <span>üîó</span>
                            <span>Web3 Compatible</span>
                        </div>
                        <div class="security-badge">
                            <span>üõ°Ô∏è</span>
                            <span>NFT Verified</span>
                        </div>
                        <div class="security-badge">
                            <span>üìñ</span>
                            <span>Premium Reader</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Method Selection Modal -->
    <div id="payment-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Choose Payment Method</h2>
                <button class="modal-close" data-action="close-modal">‚úï</button>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <div class="order-item">
                    <span>Digital Marketing Mastery</span>
                    <span>Qty: 1</span>
                </div>
                <div class="order-total">
                    Total: $25.00
                </div>
            </div>

            <!-- Payment Options -->
            <div class="payment-options">
                <!-- Stripe Option -->
                <div class="payment-option stripe" data-action="stripe-payment">
                    <div class="payment-icon">üí≥</div>
                    <h3>Credit/Debit Card</h3>
                    <ul class="payment-features">
                        <li>‚úì Instant processing</li>
                        <li>‚úì Secure via Stripe</li>
                        <li>‚úì All major cards accepted</li>
                        <li>‚úì Apple Pay & Google Pay</li>
                    </ul>
                    <button class="payment-button">Pay with Card</button>
                </div>

                <!-- Crypto Option -->
                <div class="payment-option crypto" data-action="crypto-payment">
                    <div class="payment-icon">‚Çø</div>
                    <h3>Cryptocurrency</h3>
                    <ul class="payment-features">
                        <li>‚úì Bitcoin, Ethereum, USDC, Solana</li>
                        <li>‚úì Secure blockchain payment</li>
                        <li>‚úì Lower transaction fees</li>
                        <li>‚úì Decentralized & private</li>
                    </ul>
                    <button class="payment-button">Pay with Crypto</button>
                </div>
            </div>

            <!-- Security Notice -->
            <div class="text-center mt-3">
                <p style="font-size: 0.9rem; color: var(--gray-color);">
                    üîí Payments secured by industry leaders<br>
                    <a href="/support" style="color: var(--primary-color);">üìû Need help? Contact us</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Crypto Currency Selection (Hidden by default) -->
    <div id="crypto-selection" style="display: none;">
        <div class="container">
            <div class="crypto-checkout">
                <h2 class="text-center mb-4">Select Cryptocurrency</h2>

                <div class="currency-selector">
                    <!-- Bitcoin -->
                    <div class="currency-card" data-currency="btc" data-crypto="btc">
                        <div class="currency-icon">‚Çø</div>
                        <div class="currency-name">Bitcoin</div>
                        <div class="currency-amount">‚âà 0.0008 BTC</div>
                        <div class="currency-network">Bitcoin Network</div>
                    </div>

                    <!-- Ethereum -->
                    <div class="currency-card" data-currency="eth" data-crypto="eth">
                        <div class="currency-icon">Œû</div>
                        <div class="currency-name">Ethereum</div>
                        <div class="currency-amount">‚âà 0.0156 ETH</div>
                        <div class="currency-network">Ethereum Network</div>
                    </div>

                    <!-- USDC -->
                    <div class="currency-card" data-currency="usdc" data-crypto="usdc">
                        <div class="currency-icon">üíé</div>
                        <div class="currency-name">USD Coin</div>
                        <div class="currency-amount">‚âà 25.00 USDC</div>
                        <div class="currency-network">Ethereum Network</div>
                    </div>

                    <!-- Solana -->
                    <div class="currency-card" data-currency="sol" data-crypto="sol">
                        <div class="currency-icon">‚òÄÔ∏è</div>
                        <div class="currency-name">Solana</div>
                        <div class="currency-amount">‚âà 0.58 SOL</div>
                        <div class="currency-network">Solana Network</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Crypto Payment Details (Hidden by default) -->
    <div id="crypto-payment" style="display: none;">
        <div class="container">
            <div class="crypto-checkout">
                <h2 class="text-center mb-4">Complete Your Crypto Payment</h2>

                <div class="payment-details">
                    <!-- Payment Amount -->
                    <div class="payment-amount" id="payment-amount">
                        0.0008 BTC
                    </div>

                    <!-- Wallet Address -->
                    <div class="wallet-address-section">
                        <h4>Send payment to this address:</h4>
                        <div class="wallet-address" id="wallet-address" data-address="">
                            bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh
                        </div>
                        <button class="copy-button" data-action="copy-address">
                            üìã Copy Address
                        </button>
                    </div>

                    <!-- QR Code -->
                    <div class="text-center">
                        <h4>Or scan QR code:</h4>
                        <div id="qr-code-container" class="qr-code-container"></div>
                    </div>

                    <!-- Timer and Status -->
                    <div class="text-center">
                        <div class="payment-timer" id="payment-timer">
                            Complete payment within 15:00
                        </div>
                        <div class="payment-status" id="payment-status">
                            üîÑ Waiting for Payment
                        </div>
                        <div class="payment-instructions">
                            üí° Send the exact amount to the address above. Payment will be confirmed automatically.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wallet Connection Modal -->
    <div id="wallet-connection-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Connect Wallet</h2>
                <button class="modal-close" onclick="closeWalletModal()">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Wallet Selection State -->
                <div id="wallet-selection" class="wallet-selection">
                    <h3>Choose Your Wallet</h3>

                    <div class="wallet-options">
                        <div class="wallet-option" onclick="connectMetaMask()">
                            <div class="wallet-icon">ü¶ä</div>
                            <div class="wallet-info">
                                <div class="wallet-name">MetaMask</div>
                                <div class="wallet-description">Most popular Ethereum wallet</div>
                            </div>
                            <div id="metamask-badge" class="installed-badge" style="display: none;">Installed</div>
                        </div>

                        <div class="wallet-option" onclick="connectWalletConnect()">
                            <div class="wallet-icon">üîó</div>
                            <div class="wallet-info">
                                <div class="wallet-name">WalletConnect</div>
                                <div class="wallet-description">Connect with QR code</div>
                            </div>
                        </div>

                        <div class="wallet-option" onclick="connectCoinbase()">
                            <div class="wallet-icon">üîµ</div>
                            <div class="wallet-info">
                                <div class="wallet-name">Coinbase Wallet</div>
                                <div class="wallet-description">Secure and easy to use</div>
                            </div>
                        </div>

                        <div class="wallet-option" onclick="connectTrustWallet()">
                            <div class="wallet-icon">üõ°Ô∏è</div>
                            <div class="wallet-info">
                                <div class="wallet-name">Trust Wallet</div>
                                <div class="wallet-description">Mobile-first wallet</div>
                            </div>
                        </div>
                    </div>

                    <div class="security-notice">
                        <p>üîí Your wallet will be securely connected using cryptographic signatures</p>
                    </div>
                </div>

                <!-- Connection Loading State -->
                <div id="connection-loading" class="connection-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <h3>Connecting to <span id="connecting-wallet-name"></span></h3>
                    <p>Please approve the connection request in your wallet</p>
                    <button class="btn btn-secondary" onclick="cancelConnection()">Cancel Connection</button>
                </div>

                <!-- Signature Request State -->
                <div id="signature-request" class="signature-request" style="display: none;">
                    <div class="signature-icon">üîè</div>
                    <h3>Sign Message</h3>
                    <p>Please sign this message to authenticate your wallet</p>

                    <div class="signature-message">
                        <pre id="signature-message-text"></pre>
                    </div>

                    <div class="signature-notice">
                        <p>This signature is required for security and will not cost any gas</p>
                    </div>
                </div>

                <!-- Connection Success State -->
                <div id="connection-success" class="connection-success" style="display: none;">
                    <div class="success-icon">‚úÖ</div>
                    <h3>Connected!</h3>

                    <div class="connection-details">
                        <p>Wallet: <span id="connected-address"></span></p>
                        <p>Network: <span id="connected-network"></span></p>
                    </div>

                    <p>You can now access NFT-gated content and make crypto payments</p>

                    <button class="btn btn-primary" onclick="continueToBook()">Continue to Book</button>
                </div>

                <!-- Error State -->
                <div id="connection-error" class="connection-error" style="display: none;">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="error-message-text"></div>

                    <div class="error-actions">
                        <button class="btn btn-secondary" onclick="retryConnection()">Try Again</button>
                        <button class="btn btn-primary" onclick="showWalletSelection()">Choose Different Wallet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/kanes-bookstore.js"></script>

    <!-- Enhanced JavaScript for better UX -->
    <script>
        // Track current access path
        let currentPath = null;

        // Smooth scroll utility function
        function smoothScrollTo(elementId, offset = -20) {
            const element = document.getElementById(elementId);
            if (element) {
                const elementPosition = element.offsetTop + offset;
                window.scrollTo({
                    top: elementPosition,
                    behavior: 'smooth'
                });

                // Add gentle highlight effect
                element.style.transition = 'box-shadow 0.3s ease';
                element.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.3)';
                setTimeout(() => {
                    element.style.boxShadow = '';
                }, 2000);
            }
        }

        // Select NFT path
        function selectNFTPath() {
            currentPath = 'nft';
            document.getElementById('nft-path').classList.add('active');
            document.getElementById('purchase-path').classList.remove('active');

            // Hide purchase section and show NFT section with animation
            const purchaseSection = document.getElementById('purchase-section');
            const nftSection = document.getElementById('nft-access-section');

            purchaseSection.style.display = 'none';
            purchaseSection.classList.remove('show');

            nftSection.style.display = 'block';
            setTimeout(() => {
                nftSection.classList.add('show');
            }, 50);

            // Enable wallet connection
            document.getElementById('check-nfts-btn').disabled = false;
            document.getElementById('check-nfts-btn').innerHTML = 'üîó Connect Wallet to Check NFTs';

            // Smooth scroll to NFT section after brief delay for display
            setTimeout(() => {
                smoothScrollTo('nft-access-section');
            }, 200);

            // Analytics
            gtag('event', 'select_access_path', {
                access_path: 'nft',
                product_id: 'digital-marketing-mastery'
            });
        }

        // Select purchase path
        function selectPurchasePath() {
            currentPath = 'purchase';
            document.getElementById('purchase-path').classList.add('active');
            document.getElementById('nft-path').classList.remove('active');

            // Hide NFT section and show purchase section with animation
            const nftSection = document.getElementById('nft-access-section');
            const purchaseSection = document.getElementById('purchase-section');

            nftSection.style.display = 'none';
            nftSection.classList.remove('show');

            purchaseSection.style.display = 'block';
            setTimeout(() => {
                purchaseSection.classList.add('show');
            }, 50);

            // Smooth scroll to purchase section after brief delay for display
            setTimeout(() => {
                smoothScrollTo('purchase-section');
            }, 200);

            // Analytics
            gtag('event', 'select_access_path', {
                access_path: 'purchase',
                product_id: 'digital-marketing-mastery'
            });
        }

        // Enhanced NFT Access Check
        async function checkNFTAccess() {
            const button = document.getElementById('check-nfts-btn');
            const status = document.getElementById('nft-status');

            // First check if wallet is connected
            if (!window.ethereum || !window.ethereum.selectedAddress) {
                openWalletModal();
                return;
            }

            try {
                button.disabled = true;
                button.innerHTML = 'üîÑ Checking NFTs...';
                status.innerHTML = 'Scanning your wallet for qualifying NFTs...';

                // Mock NFT check (replace with actual implementation)
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Simulate NFT found (for demo purposes)
                const hasNFT = Math.random() > 0.5; // 50% chance for demo

                if (hasNFT) {
                    status.innerHTML = '‚úÖ NFT Found! You have access to this book.';
                    const successSection = document.getElementById('success-section');
                    successSection.style.display = 'block';
                    setTimeout(() => {
                        successSection.classList.add('show');
                    }, 50);
                    document.getElementById('access-message').innerHTML = 'Your NFT grants you free access to this book!';

                    // Smooth scroll to success section after brief delay for display
                    setTimeout(() => {
                        smoothScrollTo('success-section');
                    }, 300);

                    // Analytics
                    gtag('event', 'nft_access_granted', {
                        product_id: 'digital-marketing-mastery',
                        wallet_address: window.ethereum.selectedAddress
                    });
                } else {
                    status.innerHTML = '‚ùå No qualifying NFTs found in your wallet.';
                    button.innerHTML = 'üîÑ Check Again';
                    button.disabled = false;

                    // Show purchase option with smooth scroll
                    setTimeout(() => {
                        if (confirm('No qualifying NFTs found. Would you like to purchase the book instead?')) {
                            selectPurchasePath();
                        }
                    }, 1000);
                }
            } catch (error) {
                console.error('Error checking NFT access:', error);
                status.innerHTML = '‚ùå Error checking NFTs. Please try again.';
                button.innerHTML = 'üîÑ Try Again';
                button.disabled = false;
            }
        }

        // Open ebook reader
        function openEbookReader() {
            // Analytics
            gtag('event', 'open_ebook_reader', {
                product_id: 'digital-marketing-mastery',
                access_type: currentPath
            });

            // Add loading state before navigation
            const button = document.getElementById('btn-read-now');
            if (button) {
                button.innerHTML = 'üîÑ Opening Reader...';
                button.disabled = true;
            }

            window.location.href = '05-ebook-reader.html';
        }

        // Smooth scroll to section by name (for external calls)
        function scrollToSection(sectionName) {
            const sectionMap = {
                'access-paths': 'nft-path',
                'how-it-works': 'how-it-works',
                'product-description': 'product-description',
                'product-features': 'product-features',
                'security-badges': 'security-badges'
            };

            const elementId = sectionMap[sectionName] || sectionName;
            smoothScrollTo(elementId);
        }

        // Enhanced payment button interactions
        function handlePaymentButtonClick(event) {
            const button = event.target;
            const action = button.getAttribute('data-action');

            if (action === 'stripe-payment') {
                // Add loading state
                button.innerHTML = 'üîÑ Processing...';
                button.disabled = true;

                // Simulate processing and show success
                setTimeout(() => {
                    const purchaseSection = document.getElementById('purchase-section');
                    const successSection = document.getElementById('success-section');

                    purchaseSection.style.display = 'none';
                    purchaseSection.classList.remove('show');

                    successSection.style.display = 'block';
                    setTimeout(() => {
                        successSection.classList.add('show');
                    }, 50);

                    document.getElementById('access-message').innerHTML = 'Payment successful! You now have full access to this book.';

                    // Scroll to success section
                    setTimeout(() => {
                        smoothScrollTo('success-section');
                    }, 300);
                }, 2000);
            }
        }

        // Initialize page with enhanced flow detection
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is coming from a specific flow
            const urlParams = new URLSearchParams(window.location.search);
            const accessType = urlParams.get('access');
            const source = urlParams.get('source');
            const scrollTo = urlParams.get('scrollTo');

            // Handle returning users with contextual messaging
            if (source === 'reader') {
                showReturningUserMessage('Welcome back! Continue where you left off or explore more books.');
            } else if (source === 'confirmation') {
                showReturningUserMessage('Want to purchase additional books? Check out our collection!');
            }

            // Auto-select path based on URL parameters
            if (accessType === 'nft') {
                selectNFTPath();
            } else if (accessType === 'purchase') {
                selectPurchasePath();
            }

            // Handle direct scroll requests from URL
            if (scrollTo) {
                setTimeout(() => {
                    scrollToSection(scrollTo);
                }, 500);
            }

            // Check if wallet is already connected
            if (window.ethereum && window.ethereum.selectedAddress) {
                document.getElementById('check-nfts-btn').disabled = false;
                document.getElementById('check-nfts-btn').innerHTML = 'üîç Check My NFTs';
            }

            // Add enhanced payment button interactions
            document.querySelectorAll('[data-action="stripe-payment"]').forEach(button => {
                button.addEventListener('click', handlePaymentButtonClick);
            });

            // Add smooth scroll to "Read More" links if they exist
            document.querySelectorAll('a[href^="#"]').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    smoothScrollTo(targetId);
                });
            });

            // Add entrance animations for sections
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });

            // Observe key sections for animations
            document.querySelectorAll('#nft-access-section, #purchase-section, #success-section').forEach(section => {
                section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                observer.observe(section);
            });
        });

        function showReturningUserMessage(message) {
            const messageBar = document.createElement('div');
            messageBar.style.cssText = `
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 1rem;
                text-align: center;
                font-weight: 600;
                position: relative;
                overflow: hidden;
                margin-bottom: 1rem;
                border-radius: 8px;
            `;
            messageBar.innerHTML = `
                <div style="position: relative; z-index: 1;">
                    <span style="margin-right: 0.5rem;">üëã</span>
                    ${message}
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: white;
                        margin-left: 1rem;
                        cursor: pointer;
                        opacity: 0.8;
                        font-size: 1.2rem;
                    ">√ó</button>
                </div>
            `;

            const container = document.querySelector('.container');
            if (container) {
                container.insertBefore(messageBar, container.firstChild);
            }

            // Auto-hide after 6 seconds
            setTimeout(() => {
                if (messageBar.parentElement) {
                    messageBar.remove();
                }
            }, 6000);
        }
    </script>

    <!-- Analytics -->
    <script>
        // Google Analytics 4
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'Product Detail - Digital Marketing Mastery',
            page_location: window.location.href
        });

        // Track product view
        gtag('event', 'view_item', {
            currency: 'USD',
            value: 25.00,
            items: [{
                item_id: 'digital-marketing-mastery',
                item_name: 'Digital Marketing Mastery',
                category: 'Digital Products',
                price: 25.00,
                quantity: 1
            }]
        });
    </script>
</body>

</html>